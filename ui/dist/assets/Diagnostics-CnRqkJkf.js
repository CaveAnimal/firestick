import{j as t}from"./index-BITMq2dn.js";import{r as i}from"./react-CrAnlijj.js";import"./monaco-amF-kVe2.js";import"./recharts-BIV-EGEs.js";function M(){var b,k;const[o,h]=i.useState({ok:!1}),[r,p]=i.useState({ok:!1}),[d,g]=i.useState(!1),u=i.useCallback(async()=>{g(!0);try{{const a=performance.now();try{const e=new AbortController,s=window.setTimeout(()=>e.abort(),5e3),n=await fetch("/api/health",{signal:e.signal});window.clearTimeout(s);const l=Math.max(0,Math.round(performance.now()-a));if(n.ok){const f=await n.json().catch(()=>({}));h({ok:!0,status:n.status,ms:l,data:f})}else h({ok:!1,status:n.status,ms:l,error:`HTTP ${n.status}`})}catch(e){const s=Math.max(0,Math.round(performance.now()-a));h({ok:!1,ms:s,error:(e==null?void 0:e.name)==="AbortError"?"Timed out":(e==null?void 0:e.message)||"Fetch failed"})}}{const a=performance.now();try{const e=new AbortController,s=window.setTimeout(()=>e.abort(),5e3),n=await fetch("/api/embedding/info",{signal:e.signal});window.clearTimeout(s);const l=Math.max(0,Math.round(performance.now()-a));if(n.ok){const f=await n.json().catch(()=>({}));p({ok:!0,status:n.status,ms:l,data:f})}else p({ok:!1,status:n.status,ms:l,error:`HTTP ${n.status}`})}catch(e){const s=Math.max(0,Math.round(performance.now()-a));p({ok:!1,ms:s,error:(e==null?void 0:e.name)==="AbortError"?"Timed out":(e==null?void 0:e.message)||"Fetch failed"})}}}finally{g(!1)}},[]);i.useEffect(()=>{u()},[u]);const m=i.useMemo(()=>{var e;const a=(((e=r.data)==null?void 0:e.mode)||"").toString().toUpperCase();return a==="ONNX"||a==="MOCK"?a:""},[r.data]),x=i.useMemo(()=>{var e;return(Array.isArray((e=r.data)==null?void 0:e.activeProfiles)?r.data.activeProfiles:[]).map(s=>String(s))},[r.data]),c=(a,e,s)=>t.jsxs("span",{title:s||a,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"2px 8px",borderRadius:999,border:"1px solid #eee",background:"#fafafa"},children:[t.jsx("span",{"aria-hidden":"true",style:{width:8,height:8,borderRadius:"50%",background:e}}),t.jsx("span",{children:a})]});return t.jsxs("div",{children:[t.jsx("h2",{children:"Diagnostics"}),t.jsx("p",{children:"Quick connectivity and configuration checks."}),t.jsxs("div",{style:{display:"grid",gap:12},children:[t.jsxs("section",{style:{border:"1px solid #eee",borderRadius:8,padding:12},children:[t.jsx("h3",{style:{marginTop:0},children:"Backend Health"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[c(o.ok?"Connected":"No connection",o.ok?"#2ecc71":"#e74c3c",o.error),t.jsx("span",{title:"Round-trip time",children:typeof o.ms=="number"?`${o.ms} ms`:""}),t.jsx("button",{onClick:u,disabled:d,"aria-busy":d,children:d?"Checking…":"Re-run checks"})]}),t.jsx("pre",{style:{background:"#f9f9f9",padding:8,marginTop:8},children:JSON.stringify(o.data??(o.error?{error:o.error}:{}),null,2)})]}),t.jsxs("section",{style:{border:"1px solid #eee",borderRadius:8,padding:12},children:[t.jsx("h3",{style:{marginTop:0},children:"Embedding"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[c(`Mode: ${m||"—"}`,m==="ONNX"?"#8e44ad":m==="MOCK"?"#34495e":"#7f8c8d",r.error),x.length>0&&c(`Profiles: ${x.join(", ")}`,"#3498db"),((b=r.data)==null?void 0:b.modelPath)&&c(`Model: ${r.data.modelPath}`,"#95a5a6"),((k=r.data)==null?void 0:k.tokenizerPath)&&c(`Tokenizer: ${r.data.tokenizerPath}`,"#95a5a6"),t.jsx("span",{title:"Round-trip time",children:typeof r.ms=="number"?`${r.ms} ms`:""}),t.jsx("button",{onClick:u,disabled:d,"aria-busy":d,children:d?"Checking…":"Re-run checks"})]}),t.jsx("pre",{style:{background:"#f9f9f9",padding:8,marginTop:8},children:JSON.stringify(r.data??(r.error?{error:r.error}:{}),null,2)}),!m&&t.jsxs("div",{style:{marginTop:8,color:"#c0392b"},children:["Tip: If mode is blank, your backend may not include the new ",t.jsx("code",{children:"/api/embedding/info"})," endpoint. Restart from source after pulling updates, or rebuild the jar, then refresh."]})]})]})]})}export{M as default};
